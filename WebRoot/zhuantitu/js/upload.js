$.fn.upload=function(a){a=a||{},a.dom=this,$.upload(a)},$.upload=function(a){var c,d,e,f,g,h,i,j,k,b={dom:"",action:"",fileName:"file",params:{},accept:".jpg,.png",ieSubmitBtnText:"上传",dataType:"text",complete:function(){},submit:function(){}};b=$.extend(b,a),c=b.dom,d="leunpha_iframe_v"+100*Math.random(),e=c.outerWidth(),f=c.outerHeight(),g=$("<iframe name='"+d+"' style='display:none;' id='"+d+"'></iframe>"),h=$("<form></form>"),h.attr({target:d,action:b.action,method:"post","class":"ajax_form",enctype:"multipart/form-data"}).css({width:e,height:f}),i=$("<input type='file'/>"),i.attr({accept:b.accept,name:b.fileName}).css({opacity:0,position:"absolute",width:e,height:f+"px",top:0,left:0,"z-index":999}),i.change(function(){i.val()&&(b.submit.call(h),$(this).parent("form").submit())}),h.append(i),$("body").append(g),$(c).append(h);for(j in b.params)k=$("<input type='hidden'/>").attr({name:j,value:b.params[j]}),i.after(k),k=null,delete k;g.load(function(){var e,a=document.getElementById(d),c=$(a.contentWindow.document.body).text();if(c){if(e=b.dataType.toLocaleUpperCase(),"JSON"==e)try{"string"==typeof c&&(c=$.parseJSON(c))}catch(f){c="error"}b.complete.call(null,c)}})};